from rootpy.plotting.shapes import Line,Arrow

def drawBackgrounds(stack):
    temphist = stack.sum.Clone()
    stack.Draw()
    stack.sum.SetFillStyle(0)
    stack.sum.SetLineColor("black")
    stack.sum.SetLineWidth(4)
    stack.sum.Draw("Hist SAME")

    errorband = stack.sum.Clone()
    errorband.SetLineWidth(10)
    errorband.SetFillStyle(3244)
    errorband.SetFillColor(922)

    errorband.Draw("SAME E2P")




def drawsignalobjects(backgroundstacks):
    for LegendEntry in backgroundstacks:
        if 'Signal' in LegendEntry:
            backgroundstacks[LegendEntry].sum.Draw("Hist SAME X0")


def drawData(datastack):
    datastack.sum.SetMarkerStyle('circle')
    datastack.sum.SetMarkerSize(3) 
    datastack.sum.SetLineWidth(4)
    datastack.sum.Draw("SAME EP")


def drawRatio(histRatio,stack,plotData):
    #histRatio = datastack.sum.Clone()
    #histRatio.merge_bins([(0, 1), (-2, -1)])
    tempDataStack = histRatio.Clone()
    ratioMinimum=0
    ratioMaximum=2
    histRatio.SetMinimum(ratioMinimum)
    histRatio.SetMaximum(ratioMaximum)
    histRatio.yaxis.divisions = 5
    histRatio.Divide(stack.sum)

    if plotData :
        histRatio.Draw("PE")
    
    line = Line(float(xmin)+1e-2*float(xmax),1.,float(xmax)-1e-2*float(xmax),1.);
    line.SetLineWidth(4);
    line.SetLineColor("red");

    if plotData:
        line.Draw("Same");
    else:
        line.Draw();

    if plotData:
        histRatio.Draw("SAME EP")

    MCerrorband = stack.sum.Clone()
    MCerrorband.SetLineWidth(10)
    MCerrorband.SetFillStyle(3244)
    MCerrorband.SetFillColor(922)


    for i in range(1,int(nbins)+1):
        if stack.sum.GetBinContent(i) != 0:
            if tempDataStack.GetBinContent(i)/stack.sum.GetBinContent(i) >= 2:
                xcoord = stack.sum.GetBinCenter(i)
                arrow = Arrow(xcoord,1.67,xcoord,1.87,0.015,"|>")
                arrow.SetAngle(50)
                arrow.SetLineWidth(6)
                arrow.SetLineColor(2)
                arrow.SetFillColor(2)
                arrow.Draw()
            if tempDataStack.GetBinContent(i)/stack.sum.GetBinContent(i) <= -2:
                xcoord = stack.sum.GetBinCenter(i)
                arrow = Arrow(xcoord,0.33,xcoord,0.13,0.015,"|>")
                arrow.SetAngle(50)
                arrow.SetLineWidth(6)
                arrow.SetLineColor(2)
                arrow.SetFillColor(2)
                arrow.Draw();
        
        mcerror = 0.0
        content = stack.sum.GetBinContent(i)
        error = stack.sum.GetBinError(i)
        if content != 0 :
            mcerror = (content+error)/content - 1.0 
        MCerrorband.SetBinContent(i,1)
        MCerrorband.SetBinError(i,mcerror)
        
    MCerrorband.Draw("E2PSAME")
#    return histRatio
